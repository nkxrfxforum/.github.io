<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è²éª¸è©•åˆ†å·¥å…·Web</title>
    <link rel="icon"
        href="https://guide-res.aki-game.net/introduction/material/1b41e5f51811f4be861c6c93c660b7b8/6b08d1da05d2ce8bf65033419bd3ab90.png"
        type="image/png">
    <style>
        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #1a1a1a;
            --bg-card: #222;
            --border-color: #333;
            --text-primary: #fff;
            --text-secondary: #bbb;
            --accent-gold: #ffd700;
            --accent-blue: #4fc3f7;
            --accent-green: #4caf50;
            --accent-orange: #ff9800;
            --accent-red: #f44336;
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Microsoft JhengHei', 'Noto Sans TC', Arial, sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, #1a1a2e 100%);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 1rem;
        }

        /* åˆ‡æ›æŒ‰éˆ• */
        .switch-container {
            display: flex;
            gap: 0.5rem;
        }

        .switch-btn {
            padding: 0.6rem 1.2rem;
            border: 2px solid var(--border-color);
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .switch-btn.active {
            background: var(--accent-gold);
            color: #000;
            box-shadow: var(--shadow);
            transform: translateY(-2px);
        }

        .switch-btn:hover {
            border-color: var(--accent-gold);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }

        /* æ§åˆ¶é¢æ¿ */
        .controls {
            width: fit-content;
            max-width: 100%;
            margin: 0 auto 1rem;
            background: transparent;
            border: none;
            box-shadow: none;
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: nowrap;
            overflow-x: auto;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
        }

        .file-input-wrapper {
            position: relative;
            width: auto;
        }

        .file-input {
            display: none;
        }

        .file-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: auto;
            min-width: 80px;
            padding: 0.8rem 1rem;
            background: rgba(255, 215, 0, 0.1);
            color: var(--accent-gold);
            border: 2px dashed var(--accent-gold);
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            backdrop-filter: blur(5px);
            height: 50px;
            white-space: nowrap;
        }

        .file-btn:hover {
            background: rgba(255, 215, 0, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
        }

        .switch-btn {
            padding: 0.8rem 1.5rem;
            border: 2px solid var(--border-color);
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 1rem;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            white-space: nowrap;
        }

        /* ä¸»è¦å…§å®¹å€åŸŸ */
        .main-content {
            max-width: 98%;
            margin: 0 auto;
        }

        /* ==================== å¯¬ç‰ˆï¼ˆå®Œæ•´è³‡æ–™ï¼‰ ==================== */
        .landscape-layout {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        /* ==================== é•·ç‰ˆï¼ˆè¶…å¯†é›†æ’ç‰ˆï¼‰ ==================== */
        .portrait-layout {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
            max-width: 600px;
            margin: 0 auto;
        }

        /* ==================== è§’è‰²å¡ç‰‡ (é€šç”¨) ==================== */
        .character-card {
            background: linear-gradient(145deg, var(--bg-card), #2a2a2a);
            border-radius: 20px;
            border: 2px solid var(--border-color);
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        /* ========== å¯¬ç‰ˆè§’è‰²å¡ ========== */
        .landscape-layout .character-card {
            padding: 1.5rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .landscape-layout .character-header {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            margin-bottom: 0;
        }

        .landscape-layout .avatar-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            flex-shrink: 0;
        }

        .landscape-layout .character-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--accent-gold);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3);
        }

        .landscape-layout .character-info {
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding-top: 10px;
        }

        .landscape-layout .character-info h1 {
            font-size: 2.2rem;
            font-weight: bold;
            background: linear-gradient(45deg, var(--accent-gold), var(--accent-orange));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            line-height: 1.2;
        }

        /* æ˜Ÿæ˜Ÿæ¨£å¼ */
        .star {
            width: 16px;
            height: 16px;
            fill: var(--accent-gold);
        }

        .star.empty {
            fill: #444;
        }

        .landscape-layout .character-stars {
            display: flex;
            gap: 2px;
        }

        /* ========== é•·ç‰ˆè§’è‰²å¡ ========== */
        .portrait-layout .character-card {
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .portrait-layout .character-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--accent-gold);
            flex-shrink: 0;
        }

        .portrait-layout .character-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .portrait-layout .character-info h1 {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--accent-gold);
            margin-bottom: 0.2rem;
        }

        .portrait-layout .character-stars {
            display: flex;
            gap: 0.1rem;
            margin-bottom: 0.2rem;
        }

        .portrait-layout .star {
            width: 12px;
            height: 12px;
        }

        /* ========== UID æ¨£å¼ ========== */
        .character-uid {
            font-family: 'Courier New', monospace;
            color: var(--text-secondary);
            font-weight: bold;
            letter-spacing: 0.5px;
        }

        .landscape-layout .character-uid {
            font-size: 1.1rem;
            color: var(--accent-blue);
        }

        .portrait-layout .character-uid {
            font-size: 0.8rem;
            color: var(--accent-blue);
        }

        /* ==================== ç¸½åˆ† ==================== */
        .stats-grid {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0;
            margin-top: 0;
            background: transparent;
            border: none;
        }

        /* å¯¬ç‰ˆç¸½åˆ† */
        .landscape-layout .stats-grid {
            justify-content: flex-end;
            padding-left: 0;
            margin: 0;
        }

        .landscape-layout .stat-value {
            font-size: 5rem;
            font-weight: 900;
            line-height: 1;
            background: linear-gradient(45deg, var(--accent-gold), var(--accent-orange));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 10px 30px rgba(255, 215, 0, 0.2);
        }

        /* é•·ç‰ˆç¸½åˆ† */
        .portrait-layout .stats-grid {
            margin-left: auto;
        }

        .portrait-layout .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--accent-gold);
        }

        /* ==================== è²éª¸å€åŸŸ ==================== */
        .equipment-section {
            background: linear-gradient(145deg, var(--bg-card), #2a2a2a);
            border-radius: 20px;
            border: 2px solid var(--border-color);
            box-shadow: var(--shadow);
        }

        /* è²éª¸ç¶²æ ¼ */
        .equipment-grid.landscape {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            padding: 2rem;
            min-height: 500px;
            width: 100%;
        }

        .equipment-grid.portrait {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.6rem;
            padding: 1rem;
        }

        @media (max-width: 768px) {
            .equipment-grid.portrait {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.5rem;
                padding: 0.8rem;
            }

            .landscape-layout .character-card {
                flex-direction: column;
                align-items: stretch;
                text-align: center;
                gap: 1rem;
            }

            .landscape-layout .character-header {
                flex-direction: column;
                gap: 0.5rem;
            }

            .landscape-layout .stats-grid {
                justify-content: center;
                margin-top: 0.5rem;
            }

            #signUpModal .modal-content {
                width: 95%;
                padding: 1rem;
            }
        }

        /* è²éª¸å¡ç‰‡ */
        .equipment-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .landscape-layout .equipment-card {
            border-radius: 16px;
            padding: 1.2rem;
            min-height: 200px;
        }

        .portrait-layout .equipment-card {
            border-radius: 10px;
            padding: 0.6rem;
            min-height: 120px;
            font-size: 0.7rem;
        }

        .equipment-card:hover {
            transform: translateY(-3px);
            border-color: var(--accent-gold);
        }

        /* æ¨™é¡Œåˆ—ï¼šCost + åç¨± + åˆ†æ•¸ */
        .equipment-header-row {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 0.8rem;
            font-weight: bold;
            line-height: 1.2;
            width: 100%;
        }

        .portrait-layout .equipment-header-row {
            margin-bottom: 0.4rem;
            font-size: 0.75rem;
            white-space: nowrap;
            overflow: hidden;
        }

        .cost-num {
            font-family: 'Courier New', monospace;
            font-weight: 900;
        }

        .landscape-layout .cost-num {
            font-size: 1.3rem;
        }

        .portrait-layout .cost-num {
            font-size: 0.9rem;
        }

        .cost-4 {
            color: #ffd700;
        }

        .cost-3 {
            color: #4fc3f7;
        }

        .cost-1 {
            color: #bbb;
        }

        .echo-name {
            color: var(--text-primary);
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .landscape-layout .echo-name {
            font-size: 1.2rem;
        }

        .echo-score {
            font-family: 'Courier New', monospace;
        }

        .landscape-layout .echo-score {
            font-size: 1.3rem;
        }

        .portrait-layout .echo-score {
            font-size: 0.9rem;
        }

        .score-high {
            color: var(--accent-green);
        }

        .score-medium {
            color: var(--accent-orange);
        }

        .score-low {
            color: var(--accent-red);
        }

        /* è©æ¢è¡¨æ ¼ */
        .affix-table {
            width: 100%;
            border-collapse: collapse;
            flex: 1;
        }

        .landscape-layout .affix-table {
            font-size: 1.1rem;
        }

        .landscape-layout .affix-table td {
            padding: 0.4rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .landscape-layout .affix-value {
            padding-right: 2rem;
        }

        .landscape-layout .affix-point {
            width: 60px;
        }

        .portrait-layout .affix-table {
            font-size: 0.65rem;
        }

        .portrait-layout .affix-table td {
            padding: 0.15rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .affix-name {
            color: var(--text-secondary);
            text-align: left;
        }

        .affix-value {
            text-align: right;
            color: var(--text-primary);
            padding-right: 5px;
        }

        .affix-point {
            text-align: right;
            width: 30px;
            font-weight: bold;
        }

        .point-pos {
            color: var(--accent-orange);
            opacity: 0.9;
        }

        .point-zero {
            color: #444;
        }

        .no-data {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in-up {
            animation: fadeInUp 0.4s ease-out forwards;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--bg-card);
            border: 2px solid var(--border-color);
            border-radius: 20px;
            box-shadow: var(--shadow);
            padding: 2rem;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            color: var(--text-primary);
        }

        .close-btn {
            position: absolute;
            top: 1rem;
            right: 1.5rem;
            font-size: 2rem;
            cursor: pointer;
            color: var(--text-secondary);
            transition: color 0.3s;
        }

        .close-btn:hover {
            color: var(--accent-red);
        }

        .modal h1 {
            text-align: center;
            margin-bottom: 2rem;
            color: var(--accent-gold);
        }

        .section {
            margin-bottom: 2rem;
        }

        .section-title {
            color: var(--accent-blue);
            font-size: 1.1rem;
            margin-bottom: 1rem;
            font-weight: bold;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.5rem;
        }

        .file-input-group {
            margin-bottom: 1rem;
        }

        .file-input-label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
        }

        .modal input[type="file"] {
            width: 100%;
            padding: 0.8rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            cursor: pointer;
        }

        .modal select {
            width: 100%;
            padding: 0.8rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            cursor: pointer;
            appearance: none;
        }

        .modal select:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .modal .btn {
            background: linear-gradient(135deg, var(--accent-gold) 0%, var(--accent-orange) 100%);
            color: #000;
            border: none;
            padding: 1rem;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .modal .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }

        .modal .btn:disabled {
            background: #444;
            color: #888;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .info-box {
            background: rgba(255, 255, 255, 0.05);
            border-left: 4px solid var(--accent-gold);
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
        }

        .info-box p {
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
        }

        .info-box span {
            color: var(--text-primary);
            font-weight: bold;
        }

        .message {
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            display: none;
            text-align: center;
            font-weight: bold;
        }

        .message.success {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid var(--accent-green);
            color: var(--accent-green);
        }

        .message.error {
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid var(--accent-red);
            color: var(--accent-red);
        }

        /* ç¯©é¸æŒ‰éˆ•æ¨£å¼ */
        .filter-btn {
            padding: 0.4rem 0.8rem;
            border: 1px solid var(--border-color);
            background: var(--bg-secondary);
            color: var(--text-secondary);
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        .filter-btn:hover {
            border-color: var(--accent-gold);
            color: var(--text-primary);
        }

        .filter-btn.active {
            background: var(--accent-gold);
            color: #000;
            border-color: var(--accent-gold);
            font-weight: bold;
        }

        /* Chain Badge Style */
        .chain-badge {
            background: rgba(255, 215, 0, 0.1);
            color: var(--accent-gold);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            font-size: 0.5em;
            cursor: pointer;
            border: 1px solid var(--accent-gold);
            margin-left: 10px;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            vertical-align: middle;
        }

        .chain-badge:hover {
            background: var(--accent-gold);
            color: #000;
            transform: scale(1.1);
        }
    </style>
</head>

<body>
    <div class="controls">
        <button id="homeBtn" class="switch-btn" onclick="closeRankSection()"><img
                src="https://guide-res.aki-game.net/introduction/material/1b41e5f51811f4be861c6c93c660b7b8/6b08d1da05d2ce8bf65033419bd3ab90.png"
                style="width: 30px; height: 30px; border-radius: 50%; margin-right: 5px; object-fit: cover;">3.0</button>

        <div class="file-input-wrapper">
            <input type="file" id="imageInput" class="file-input" accept="image/jpeg,image/jpg">
            <label for="imageInput" class="file-btn">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                    style="height: 1.5em; width: auto; fill: currentColor;">
                    <path
                        d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z" />
                </svg>
            </label>
        </div>

        <div style="display:none; align-items:center; gap:0.6rem; margin-left:0.6rem;">
            <input id="quickJson" placeholder="è²¼ä¸Š JSON ä¸¦æŒ‰ Enter"
                style="width:260px; padding:0.6rem; border-radius:8px; background:rgba(255,255,255,0.03); color:var(--text-primary); border:1px solid rgba(255,255,255,0.06); font-family:monospace; font-size:0.9rem;">
        </div>

        <div class="file-input-wrapper">
            <button id="urlBtn" class="file-btn">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                    style="height: 1.5em; width: auto; fill: currentColor;">
                    <path
                        d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z" />
                </svg>
            </button>
        </div>

        <div class="file-input-wrapper">
            <button id="echoBtn" class="file-btn">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"
                    style="height: 1.5em; width: auto; fill: currentColor;">
                    <path
                        d="M20.79 18.18A2.12 2.12 0 0 1 22.88 20l.92 7a15.28 15.28 0 0 0 4.12 8.53 28 28 0 0 0-4.38 10.06c1.6 2 4.43 3.8 9.18 5.46a2.8 2.8 0 0 1 1.89 2.65c0 4.66 2 8.27 5.57 10.45l.22-2.8a2.82 2.82 0 0 1 3.28-2.56c2.42.4 5.1.83 6.32 1 1.22-.18 3.9-.61 6.32-1a2.82 2.82 0 0 1 3.28 2.56l.22 2.8c3.62-2.18 5.57-5.79 5.57-10.45a2.8 2.8 0 0 1 1.89-2.7c4.75-1.66 7.58-3.46 9.18-5.46a28 28 0 0 0-4.38-10.06A15.28 15.28 0 0 0 76.2 27l.92-7a2.12 2.12 0 0 1 2.09-1.86 2.09 2.09 0 0 0 1.93-1.32l4-9.79-20.39 20.65a5.25 5.25 0 0 0-2.63-1h-.25v-1.44a8.73 8.73 0 0 0-2.08-5.67L55.88 15a.14.14 0 0 0-.24.14 26.34 26.34 0 0 1 0 11.6H55c-1.8 0-4.07 1.61-5 3.68-.92-2.07-3.19-3.68-5-3.68h-.67a26.34 26.34 0 0 1 0-11.6.14.14 0 0 0-.24-.14l-3.91 4.59a8.73 8.73 0 0 0-2.08 5.67v1.48h-.25a5.25 5.25 0 0 0-2.63 1L14.85 7.07l4 9.79a2.09 2.09 0 0 0 1.94 1.32Zm33.29 30 9.4-9.57H64a2.69 2.69 0 0 1 2.67 2.72v.4a6.88 6.88 0 0 1-6.82 6.95h-5.56a.29.29 0 0 1-.21-.49Zm-20.73-6.84A2.69 2.69 0 0 1 36 38.62h.5l9.4 9.57a.29.29 0 0 1-.21.5h-5.52a6.88 6.88 0 0 1-6.82-6.95Zm51.24 2.8c2.63 4.71 5.8 9.4 3.11 10.67-3.79 1.8-8.74 4-12.75 13.72-3.79 9.2-6.52 10.65-17.46 12.15a17.73 17.73 0 0 0-4.84 1.44A25.78 25.78 0 0 0 54 79c1.06-3.15 3.1-4.34 8-7.24a14.63 14.63 0 0 0 6.7-4c1.94-1.94 3.89-6.38 6.56-14-.67.37-3.59 1.71-4.27 2-.68 7.48-5.27 13-12.82 15.29a2.62 2.62 0 0 1-.83.13 2.83 2.83 0 0 1-2.82-2.6l-.28-3.68c-1.15.19-2 .32-2.64.41a2.72 2.72 0 0 1-1.14.25 3 3 0 0 1-.42 0 3 3 0 0 1-.42 0 2.72 2.72 0 0 1-1.14-.25c-.64-.09-1.49-.22-2.64-.41l-.29 3.68a2.79 2.79 0 0 1-1.22 2.11 2.84 2.84 0 0 1-1.59.49 2.62 2.62 0 0 1-.83-.13c-7.55-2.29-12.14-7.81-12.82-15.29-.68-.27-3.6-1.61-4.27-2 2.67 7.65 4.62 12.09 6.56 14a14.63 14.63 0 0 0 6.7 4c4.89 2.9 6.94 4.09 8 7.24a25.78 25.78 0 0 0 1.31 3.16 17.73 17.73 0 0 0-4.84-1.44c-10.94-1.5-13.67-3-17.46-12.15-4-9.71-9-11.92-12.75-13.72-2.69-1.27.48-6 3.11-10.67C7.33 46.16 2.82 52.27 2 56.31c8.08 1.49 11.29 2 16.88 8.23 3.06 3.39 2 11.36 10.38 16.3 6.28 3.69 12 8.46 20.37 11.76v.33l.42-.17.42.17v-.33c8.37-3.3 14.09-8.07 20.37-11.76 8.41-4.94 7.32-12.91 10.38-16.3 5.59-6.21 8.8-6.74 16.88-8.23-.92-4.04-5.43-10.15-13.51-12.17Z" />
                </svg>
            </button>
        </div>

        <div class="file-input-wrapper">
            <button id="rankBtn" class="file-btn">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
                    style="height: 1.5em; width: auto; fill: currentColor;">
                    <path d="M16 11V3H8v6H2v12h20V11h-6zm-6-6h4v14h-4V5zm-6 6h4v8H4v-8zm16 8h-4v-6h4v6z" />
                </svg>
            </button>
        </div>

        <button class="switch-btn" id="layoutToggle">ğŸ’»</button>
    </div>

    <!-- Chain Selection Modal -->
    <div class="modal" id="chainSelectModal">
        <div class="modal-content" style="max-width: 300px; text-align: center;">
            <span class="close-btn" onclick="closeChainModal()">&times;</span>
            <h2 style="color: var(--accent-gold); margin-bottom: 20px;">é¸æ“‡å…±é³´éˆ</h2>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                <button class="switch-btn" onclick="selectChain(0)">0</button>
                <button class="switch-btn" onclick="selectChain(1)">1</button>
                <button class="switch-btn" onclick="selectChain(2)">2</button>
                <button class="switch-btn" onclick="selectChain(3)">3</button>
                <button class="switch-btn" onclick="selectChain(4)">4</button>
                <button class="switch-btn" onclick="selectChain(5)">5</button>
                <button class="switch-btn" onclick="selectChain(6)">6</button>
            </div>
        </div>
    </div>

    <!-- UID ç®¡ç†å€å¡Š (å·²ç§»é™¤ï¼Œç§»è‡³è²éª¸é é¢) -->
    <!-- <div class="controls" style="justify-content: center; background: rgba(255, 255, 255, 0.05); padding: 10px; border-radius: 10px; margin-bottom: 1rem;">...</div> -->

    <div class="main-content" id="mainContent">
        <div class="no-data" id="noDataMessage">
            <div style="font-size: 1.5rem; margin-bottom: 1rem;">è²éª¸è©•åˆ†å±•ç¤ºå·¥å…·</div>
            <div style="margin-top: 1rem; color: #888;">æ­£åœ¨è®€å–é è¨­è³‡æ–™...</div>
        </div>
    </div>

    <textarea id="jsonOutput" style="display:none;"></textarea>
    <canvas id="canvas" style="display:none;"></canvas>
    <button id="copyBtn" style="display:none;"></button>
    <button id="processBtn" style="display:none;"></button>
    <input type="file" id="targetFileInput" style="display:none;">
    <select id="roleSelect" style="display:none;"></select>
    <button id="exportBtn" style="display:none;"></button>

    <div class="modal" id="exportModal">
        <div class="modal-content">
            <span class="close-btn" id="closeModalBtn">&times;</span>
            <h1>è²éª¸æ•¸æ“šåŒ¯å‡ºå·¥å…·</h1>

            <div class="section">
                <div class="section-title">æ­¥é©Ÿ 1: ç¢ºèªä¾†æºæ•¸æ“š</div>
                <div class="info-box" id="sourceInfo">
                    <p><strong>è§’è‰²ï¼š</strong><span id="characterName">å°šæœªè¼‰å…¥</span></p>
                    <p><strong>UIDï¼š</strong><span id="uid">å°šæœªè¼‰å…¥</span></p>
                    <p><strong>éˆæ•¸ï¼š</strong><span id="chainNum">0</span></p>
                    <p><strong>è²éª¸æ•¸é‡ï¼š</strong><span id="echoCount">0</span></p>
                </div>
            </div>

            <div class="section">
                <div class="section-title">æ­¥é©Ÿ 2: é¸æ“‡ç›®æ¨™æª”æ¡ˆ</div>
                <div class="file-input-group">
                    <label class="file-input-label">é¸æ“‡è¦æ›¿æ›çš„ JSON æª”æ¡ˆï¼š<a href="https://wuwaechotool.pages.dev/"
                            target="_blank" style="color: yellow;">é¸£æ½®å£°éª¸è¯„åˆ†å·¥å…·</a></label>
                    <input type="file" id="targetFileInputModal" accept=".json">
                </div>
            </div>

            <div class="section">
                <div class="section-title">æ­¥é©Ÿ 3: é¸æ“‡è§’è‰²</div>
                <div class="select-wrapper">
                    <select id="roleSelectModal" disabled>
                        <option value="">è«‹å…ˆè¼‰å…¥ç›®æ¨™ JSON æª”æ¡ˆ</option>
                    </select>
                </div>
            </div>

            <div class="section">
                <button class="btn" id="exportBtnModal" disabled>åŒ¯å‡ºæ•¸æ“š</button>
            </div>

            <div class="message" id="modalMessage"></div>
        </div>
    </div>

    <!-- Replace Echo Modal -->
    <div class="modal" id="replaceModal">
        <div class="modal-content" style="max-width: 1200px;">
            <span class="close-btn" id="closeReplaceModalBtn">&times;</span>
            <h1>æ›´æ›è²éª¸</h1>

            <div style="display: flex; gap: 2rem; flex-wrap: wrap;">
                <!-- Left: Current Echo -->
                <div style="flex: 1; min-width: 350px;">
                    <div class="section-title">ç•¶å‰è²éª¸</div>
                    <div id="currentEchoContainer" class="equipment-grid landscape"
                        style="grid-template-columns: 1fr; padding: 0; min-height: auto;"></div>
                </div>

                <!-- Right: Replacement Candidates -->
                <div style="flex: 1; min-width: 350px;">
                    <div class="section-title">å¯æ›¿æ›è²éª¸ (åŒUIDã€Costã€å±¬æ€§)</div>
                    <div id="candidateEchoList" class="equipment-grid landscape"
                        style="grid-template-columns: 1fr; padding: 0; min-height: auto; max-height: 600px; overflow-y: auto; display: block;">
                        <!-- Candidates will be injected here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Echo Modal -->
    <div class="modal" id="editModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header"
                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="color: var(--accent-gold); margin: 0;">ä¿®æ­£è²éª¸</h2>
                <span class="close-btn" id="closeEditModalBtn" style="position: static;">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group" style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; color: var(--text-secondary);">Cost:</label>
                    <select id="editCost" class="form-control"
                        style="width: 100%; padding: 8px; background: var(--bg-secondary); border: 1px solid var(--border-color); color: var(--text-primary); border-radius: 4px;"></select>
                </div>
                <div class="form-group" style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; color: var(--text-secondary);">å¥—è£
                        (Attributes):</label>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <img id="editSetImg" src=""
                            style="width: 30px; height: 30px; object-fit: contain; display: none;">
                        <select id="editSet" class="form-control"
                            style="flex: 1; padding: 8px; background: var(--bg-secondary); border: 1px solid var(--border-color); color: var(--text-primary); border-radius: 4px;"></select>
                    </div>
                </div>
                <div class="form-group" style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; color: var(--text-secondary);">ä¸»è©æ¢:</label>
                    <div style="display: flex; gap: 10px;">
                        <select id="editMainName" class="form-control"
                            style="flex: 1; padding: 8px; background: var(--bg-secondary); border: 1px solid var(--border-color); color: var(--text-primary); border-radius: 4px;"></select>
                        <select id="editMainValue" class="form-control"
                            style="flex: 1; padding: 8px; background: var(--bg-secondary); border: 1px solid var(--border-color); color: var(--text-primary); border-radius: 4px;"></select>
                    </div>
                </div>
                <hr style="border: 0; border-top: 1px solid var(--border-color); margin: 15px 0;">
                <div id="editSubStatsContainer">
                    <!-- å‰¯è©æ¢ 1-5 -->
                </div>
            </div>
            <div class="modal-footer" style="text-align: right; margin-top: 20px;">
                <button id="saveEditBtn" class="file-btn" style="display: inline-flex; min-width: 100px;">å„²å­˜</button>
            </div>
        </div>
    </div>

    <!-- URL Input Modal -->
    <div class="modal" id="urlInputModal">
        <div class="modal-content" style="max-width: 500px;">
            <span class="close-btn" id="closeUrlModalBtn">&times;</span>
            <h1 style="color: var(--accent-gold); margin-bottom: 1.5rem;">è¼¸å…¥åœ–ç‰‡ç¶²å€</h1>

            <div class="section">
                <div class="info-box">
                    <p>è«‹è¼¸å…¥ä»¥ä¸‹æ ¼å¼çš„åœ–ç‰‡ç¶²å€ï¼š</p>
                    <p style="color: var(--accent-blue); font-family: monospace; font-size: 0.85rem;">
                        https://wutheringwaves-dc.kurogames-global.com/.../*.jpeg</p>
                </div>

                <div class="file-input-group">
                    <label class="file-input-label">åœ–ç‰‡ç¶²å€</label>
                    <input type="text" id="imageUrlInput"
                        placeholder="https://wutheringwaves-dc.kurogames-global.com/.../image.jpeg"
                        style="width: 100%; padding: 0.8rem; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-family: monospace; font-size: 0.9rem;">
                </div>
            </div>

            <div class="section">
                <button class="btn" id="scoreFromUrlBtn" disabled>è©•åˆ†</button>
            </div>

            <div class="message" id="urlModalMessage"></div>
        </div>
    </div>

    <!-- Import Instruction Modal -->
    <div class="modal" id="importInstructionModal">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close-btn" id="closeImportInstructionModalBtn">&times;</span>
            <h1>æˆªåœ–åŒ¯å…¥èªªæ˜</h1>

            <div class="section">
                <div class="info-box">
                    <p>1. éŠæˆ²æ‰“é–‹èƒŒåŒ…é¸æ“‡å–®ä¸€è²éª¸</p>
                    <p>2. é™å®šè§£æåº¦ï¼Œ1920*1080ï¼Œå»ºè­°è¦–çª—åŒ–</p>
                </div>

                <div class="section-title">æ¨è–¦ä½¿ç”¨"å‰ªå–å·¥å…·"(Windowså…§å»º)</div>
                <div class="info-box">
                    <p>1. é–‹å•Ÿå¾Œå‰ªå–å¤§å°é¸æ“‡"è¦–çª—"</p>
                    <p>2. é–‹å•ŸèƒŒåŒ…è²éª¸å–®ä¸€è²éª¸</p>
                    <p>3. æŒ‰ä¸‹æŒ‰éµ Win+Shift+S å¾Œé¸æ“‡"é³´æ½®"</p>
                    <p>4. å‰ªå–å·¥å…·->å³ä¸Š...->è¨­å®š->é–‹å•Ÿè³‡æ–™å¤¾</p>
                    <p>5. åŒ¯å…¥åœ–ç‰‡</p>
                </div>
            </div>

            <div class="section">
                <button class="btn" onclick="captureScreen()" style="margin-bottom: 10px; background: transparent; border: 1px solid var(--accent-gold); color: var(--accent-gold);">ç›´æ¥æˆªå–è¢å¹•/è¦–çª— (å…å­˜æª”)</button>
                <button class="btn" id="confirmImportBtn">é¸æ“‡æª”æ¡ˆ</button>
            </div>
        </div>
    </div>

    <div id="echoPageSection"
        style="display: none; max-width: 1400px; margin: 2rem auto; background: var(--bg-card); border: 2px solid var(--border-color); border-radius: 20px; padding: 2rem; box-shadow: var(--shadow);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
            <!-- <h1 style="margin: 0; color: var(--accent-gold);">è²éª¸è³‡æ–™åº«</h1> -->
            <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
                <span style="font-weight: bold; color: var(--text-primary);">ç•¶å‰ UID:</span>
                <select id="echoPageUidSelector"
                    style="padding: 8px; border-radius: 5px; background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border-color); min-width: 150px;">
                    <option value="">æœªé¸æ“‡ (é è¨­)</option>
                </select>
                <button id="echoPageAddUidBtn" class="switch-btn"
                    style="padding: 5px 15px; height: 36px; font-size: 0.9rem;">æ–°å¢</button>
                <button id="echoPageDeleteUidBtn" class="switch-btn"
                    style="padding: 5px 15px; height: 36px; font-size: 0.9rem; background: var(--accent-red); border-color: var(--accent-red);">åˆªé™¤</button>
                <button id="echoPageImportBtn" class="switch-btn"
                    style="padding: 5px 15px; height: 36px; font-size: 0.9rem; display: none;">æˆªåœ–åŒ¯å…¥</button>
                <button id="echoPageExportDataBtn" class="switch-btn"
                    style="padding: 5px 15px; height: 36px; font-size: 0.9rem; display: none;">è²éª¸åŒ¯å‡º</button>
                <button id="echoPageImportDataBtn" class="switch-btn"
                    style="padding: 5px 15px; height: 36px; font-size: 0.9rem; display: none;">è²éª¸åŒ¯å…¥</button>
                <input type="file" id="echoPageImportDataInput" accept=".json" style="display: none;">
                <input type="file" id="echoPageImportInput" accept="image/*" multiple style="display: none;">
            </div>
        </div>

        <div class="section">
            <div class="section-title">ç¯©é¸æ¢ä»¶</div>

            <!-- Cost ç¯©é¸ -->
            <div style="margin-bottom: 1rem;">
                <div style="color: var(--text-secondary); margin-bottom: 0.5rem; font-size: 0.9rem;">Cost</div>
                <div class="filter-group" id="filterCostGroup" style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                    <button class="filter-btn active" data-type="cost" data-value="all">å…¨éƒ¨</button>
                    <button class="filter-btn" data-type="cost" data-value="4">Cost 4</button>
                    <button class="filter-btn" data-type="cost" data-value="3">Cost 3</button>
                    <button class="filter-btn" data-type="cost" data-value="1">Cost 1</button>
                </div>
            </div>

            <!-- å¥—è£ç¯©é¸ -->
            <div>
                <div style="color: var(--text-secondary); margin-bottom: 0.5rem; font-size: 0.9rem;">å¥—è£æ•ˆæœ</div>
                <div class="filter-group" id="filterSetGroup" style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                    <button class="filter-btn active" data-type="set" data-value="all">å…¨éƒ¨</button>
                    <!-- å¥—è£æŒ‰éˆ•å°‡ç”± JS å‹•æ…‹ç”Ÿæˆ -->
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-title">å·²å„²å­˜çš„è²éª¸åˆ—è¡¨</div>
            <div id="echoListContainer" style="max-height: 600px; overflow-y: auto;">
                <table style="width: 100%; border-collapse: collapse; color: var(--text-primary);">
                    <thead>
                        <tr style="border-bottom: 1px solid var(--border-color); text-align: left;">
                            <th style="padding: 10px;">è§’è‰²</th>
                            <th style="padding: 10px;">Cost</th>
                            <th style="padding: 10px;">å¥—è£</th>
                            <th style="padding: 10px;">ä¸»è©æ¢</th>
                            <th style="padding: 10px;">è©•åˆ†</th>
                            <th style="padding: 10px;">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody id="echoListTableBody">
                        <!-- è²éª¸åˆ—è¡¨å°‡æ¸²æŸ“æ–¼æ­¤ -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="historySection"
        style="display: none; max-width: 1400px; margin: 2rem auto; background: var(--bg-card); border: 2px solid var(--border-color); border-radius: 20px; padding: 2rem; box-shadow: var(--shadow);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 15px;">
            <div>
                <h1 style="margin: 0; color: var(--accent-gold);">è²éª¸è©•åˆ†å·¥å…·Web</h1>
                <div style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 5px;">by ç„¡èŠç¶“éçš„äºº</div>
            </div>
            <div class="switch-container">
                <button class="switch-btn active" id="btnShowNewFeatures" onclick="switchHistoryTab('newFeatures')">æ–°åŠŸèƒ½</button>
                <button class="switch-btn" id="btnShowHistory" onclick="switchHistoryTab('history')">æ­·å²ç´€éŒ„</button>
            </div>
        </div>

        <div class="section" style="margin-bottom: 1.5rem;">
            <div style="color: var(--text-secondary); margin-bottom: 0.8rem; font-size: 0.9rem; font-weight: bold;">ğŸ”—
                ç›¸é—œé€£çµ</div>
            <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                <a href="https://wuwaechotool.pages.dev/" target="_blank"
                    style="color: var(--accent-blue); text-decoration: none; border: 1px solid var(--accent-blue); padding: 0.4rem 0.8rem; border-radius: 4px; transition: all 0.3s ease; font-size: 0.9rem;">è²éª¸è©•åˆ†</a>
                <a href="https://wuwaguide.kurogames.com/zh-Hant/?packageId=A1834&channelId=205&svr_area=global&platform=PC"
                    target="_blank"
                    style="color: var(--accent-blue); text-decoration: none; border: 1px solid var(--accent-blue); padding: 0.4rem 0.8rem; border-radius: 4px; transition: all 0.3s ease; font-size: 0.9rem;">å®˜æ–¹æ”»ç•¥ç«™</a>
                <a href="https://forum.gamer.com.tw/C.php?bsn=74934&snA=14077&tnum=2&subbsn=6" target="_blank"
                    style="color: var(--accent-blue); text-decoration: none; border: 1px solid var(--accent-blue); padding: 0.4rem 0.8rem; border-radius: 4px; transition: all 0.3s ease; font-size: 0.9rem;">å·´å“ˆé€£çµ</a>
                <a href="https://sites.google.com/view/gamedada-ocr/Wuthering-Waves/analyze-DC" target="_blank"
                    style="color: var(--accent-blue); text-decoration: none; border: 1px solid var(--accent-blue); padding: 0.4rem 0.8rem; border-radius: 4px; transition: all 0.3s ease; font-size: 0.9rem;">GAME
                    ZH ã€Šé³´æ½®ã€‹è§’è‰²è³‡è¨Šå¡è¾¨è­˜(å·´å‹easonqiué–‹ç™¼çš„è©•åˆ†å·¥å…·)</a>
                <a href="https://nkxrfxforum.github.io/.github.io/SupAffixGame.html" target="_blank"
                    style="color: var(--accent-blue); text-decoration: none; border: 1px solid var(--accent-blue); padding: 0.4rem 0.8rem; border-radius: 4px; transition: all 0.3s ease; font-size: 0.9rem;">éª°å‰¯è©æ¢æ¨¡æ“¬å™¨</a>

            </div>
        </div>

        <!-- æ–°åŠŸèƒ½å€å¡Š -->
        <div id="newFeaturesContent">
            <div class="controls" id="featureTabsContainer" style="justify-content: flex-start; margin: 0 0 1rem 0; padding-bottom: 10px; overflow-x: auto;">
                <!-- JS ç”Ÿæˆ -->
            </div>
            <div id="featureTextContent" style="background: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 10px; margin-bottom: 1rem; color: var(--text-secondary); font-size: 1rem; line-height: 1.6;">
                è¼‰å…¥ä¸­...
            </div>
            <div id="featureImageContainer" style="text-align: center; background: rgba(0,0,0,0.2); border-radius: 10px; padding: 10px; min-height: 200px; display: flex; align-items: center; justify-content: center;">
                <video id="featureVideo" src="" style="max-width: 100%; max-height: 500px; border-radius: 5px;" autoplay loop muted playsinline></video>
            </div>
        </div>

        <!-- æ­·å²ç´€éŒ„å€å¡Š -->
        <div id="historyContent" style="display: none;">
            <div class="section" style="display: flex; gap: 10px; margin-bottom: 1rem;">
                <button class="switch-btn" id="importHistoryBtn">åŒ¯å…¥ç´€éŒ„</button>
                <button class="switch-btn" id="exportHistoryBtn">åŒ¯å‡ºç´€éŒ„</button>
                <input type="file" id="historyFileInput" accept=".json" style="display: none;">
            </div>
            <div class="section">
                <div class="section-title">å·²å„²å­˜çš„ç´€éŒ„</div>
                <div id="historyListContainer" style="max-height: 400px; overflow-y: auto;">
                    <table style="width: 100%; border-collapse: collapse; color: var(--text-primary);">
                        <thead>
                            <tr style="border-bottom: 1px solid var(--border-color); text-align: left;">
                                <th style="padding: 10px;">UID</th>
                                <th style="padding: 10px;">è§’è‰²åç¨±</th>
                                <th style="padding: 10px;">ç¸½åˆ†</th>
                                <th style="padding: 10px;">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="historyTableBody">
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="message" id="historyMessage"></div>
        </div>
    </div>



    <!-- Limited Time Leaderboard Section -->
    <div id="rankSection"
        style="display: none; max-width: 1400px; margin: 2rem auto; background: var(--bg-card); border: 2px solid var(--border-color); border-radius: 20px; padding: 2rem; box-shadow: var(--shadow);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
            <h1 style="margin: 0; color: var(--accent-gold);">é™æ™‚æ’è¡Œæ¦œ(æ¸¬è©¦ä¸­)</h1>
            <div style="display: flex; gap: 10px;">
                <button id="rankRefreshBtn" class="switch-btn">åˆ·æ–°</button>
                <button id="rankSignUpBtn" class="switch-btn" onclick="openSignUpModal()">å ±ååƒåŠ </button>
            </div>
        </div>
        <p style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.9rem;">
            æ’è¡Œæ¦œä¸ä»£è¡¨å¯¦éš›å¼·åº¦ï¼Œåƒ…ç‚ºé¼“å‹µæ›´å¤šç©å®¶åƒèˆ‡ï¼Œé™å®š0éˆè©•åˆ†ã€é™å®šè²éª¸å±¬æ€§ã€é™å®šCostã€æ­¦å™¨ä¸è¨ˆç®—ã€æŠ€èƒ½ä¸è¨ˆç®—ã€‚</p>
        <div id="eventButtonsContainer" class="controls"
            style="justify-content: flex-start; margin-bottom: 1rem; padding-bottom: 10px; overflow-x: auto;"></div>
        <div id="eventDetailsContainer"
            style="background: rgba(255, 255, 255, 0.05); padding: 15px; border-radius: 10px; margin-bottom: 1rem; color: var(--text-secondary); font-size: 0.95rem; line-height: 1.6;">
        </div>
        <div id="rankLoading" style="text-align: center; color: var(--text-secondary); padding: 2rem;">æ­£åœ¨è¼‰å…¥æ’è¡Œæ¦œè³‡æ–™...
        </div>
        <div id="rankListContainer" style="display: none; overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse; color: var(--text-primary); white-space: nowrap;">
                <thead>
                    <tr style="border-bottom: 1px solid var(--border-color); text-align: left;">
                        <th style="padding: 15px; color: var(--accent-blue);">æ’å</th>
                        <th style="padding: 15px; color: var(--accent-blue);">UID</th>
                        <th style="padding: 15px; color: var(--accent-blue);">è§’è‰²</th>
                        <th style="padding: 15px; color: var(--accent-blue);">åˆ†æ•¸</th>
                        <th style="padding: 15px; color: var(--accent-blue); text-align: center;">åƒè³½è§’è‰²å¡</th>
                    </tr>
                </thead>
                <tbody id="rankTableBody">
                    <!-- Data will be injected here -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Sign Up Modal -->
    <div class="modal" id="signUpModal">
        <div class="modal-content" style="max-width: 1200px; max-height: 90vh; overflow-y: auto;">
            <span class="close-btn" onclick="closeSignUpModal()">&times;</span>
            <h1 style="text-align: center; color: var(--accent-gold); margin-bottom: 1rem;">å ±ååƒåŠ </h1>

            <div class="section">
                <div class="info-box">
                    <p>è«‹è¼¸å…¥ä»¥ä¸‹æ ¼å¼çš„åœ–ç‰‡ç¶²å€ (è‡ªå‹•ä»¥ 0 éˆé€²è¡Œè©•åˆ†)ï¼š</p>
                    <p style="color: var(--accent-blue); font-family: monospace; font-size: 0.85rem;">
                        https://wutheringwaves-dc.kurogames-global.com/.../*.jpeg</p>
                </div>
                <div class="file-input-group">
                    <label class="file-input-label">åœ–ç‰‡ç¶²å€</label>
                    <input type="text" id="signUpImageUrlInput"
                        placeholder="https://wutheringwaves-dc.kurogames-global.com/.../image.jpeg"
                        style="width: 100%; padding: 0.8rem; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-primary); font-family: monospace; font-size: 0.9rem;">
                </div>
                <button class="btn" id="signUpAnalyzeBtn" disabled>è©•åˆ†</button>
            </div>

            <div class="message" id="signUpMessage"></div>

            <div id="signUpResultContainer"
                style="min-height: 200px; display: flex; justify-content: center; align-items: center;">
                <div style="color: var(--text-secondary);">è«‹è¼¸å…¥ç¶²å€ä»¥é–‹å§‹åˆ†æ</div>
            </div>
        </div>
    </div>

    <script src="config.js"></script>
    <script src="js/game-data-resonator.js"></script>
    <script src="js/game-data-other.js"></script>
    <script src="js/ocr-discord-templates-other-data.js"></script>
    <script src="js/ocr-discord-coordinates.js"></script>
    <script src="js/ocr-backpack-coordinate.js"></script>
    <script src="js/ocr-backpack-data.js"></script>
    <script src="js/ocr-discord-templates-supaffix-number-data.js"></script>
    <script src="json/NewFeatures.js"></script>
    <script src="script.js"></script>
    <script>
        // ä½¿ç”¨ Screen Capture API é€²è¡Œæˆªåœ– (ä¸å­˜æª”)
        async function captureScreen() {
            // æª¢æŸ¥ç€è¦½å™¨æ”¯æ´åº¦èˆ‡ç’°å¢ƒ (éœ€è¦ HTTPS æˆ– localhost)
            if (!navigator.mediaDevices || !navigator.mediaDevices.getDisplayMedia) {
                alert('æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´ç›´æ¥æˆªåœ–ï¼Œæˆ–æœªåœ¨å®‰å…¨ç’°å¢ƒ (HTTPS/localhost) ä¸‹åŸ·è¡Œã€‚');
                return;
            }

            try {
                // è«‹æ±‚è¢å¹•åˆ†äº«æ¬Šé™
                const stream = await navigator.mediaDevices.getDisplayMedia({
                    video: { cursor: "never" }, // å˜—è©¦éš±è—æ¸¸æ¨™
                    audio: false
                });

                const video = document.createElement('video');
                video.srcObject = stream;
                
                // ç­‰å¾…å½±ç‰‡è¼‰å…¥ä¸¦æ’­æ”¾
                video.onloadedmetadata = async () => {
                    await video.play();
                    // æš«åœä¸€å°æ®µæ™‚é–“ç¢ºä¿ç•«é¢å·²æ¸²æŸ“
                    await new Promise(r => setTimeout(r, 300));

                    // ç¹ªè£½åˆ° Canvas
                    const canvas = document.createElement('canvas');
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                    
                    // åœæ­¢ä¸²æµ (é‡‹æ”¾è³‡æº)
                    stream.getTracks().forEach(track => track.stop());

                    // è½‰æ›ç‚º Blob ä¸¦åŒ¯å…¥
                    canvas.toBlob(async (blob) => {
                        if (blob) {
                            const file = new File([blob], "screenshot.png", { type: "image/png" });
                            
                            // é—œé–‰æ¨¡æ…‹æ¡†
                            const modal = document.getElementById('importInstructionModal');
                            if (modal) modal.classList.remove('show');
                            
                            // å‘¼å«åŒ¯å…¥è™•ç†
                            if (typeof processImportImages === 'function') {
                                await processImportImages([file]);
                            }
                        }
                    }, 'image/png');
                };
            } catch (err) {
                console.error("æˆªåœ–å¤±æ•—:", err);
                // NotAllowedError è¡¨ç¤ºä½¿ç”¨è€…å–æ¶ˆäº†é¸æ“‡ï¼Œä¸éœ€å ±éŒ¯
                if (err.name !== 'NotAllowedError') {
                    alert('æˆªåœ–å¤±æ•—: ' + err.message);
                }
            }
        }

        // ç›£è½è²¼ä¸Šäº‹ä»¶ (Ctrl+V) ä»¥æ”¯æ´ç›´æ¥åŒ¯å…¥ (è·³éé¸å–æª”æ¡ˆ)
        document.addEventListener('paste', async (event) => {
            // æª¢æŸ¥æ˜¯å¦æœ‰é–‹å•ŸåŒ¯å…¥æ¨¡æ…‹æ¡†ï¼Œæˆ–è€…æ˜¯å¦åœ¨è²éª¸é é¢
            const modal = document.getElementById('importInstructionModal');
            const echoPage = document.getElementById('echoPageSection');
            
            // åªæœ‰åœ¨æ¨¡æ…‹æ¡†é–‹å•Ÿæˆ–è²éª¸é é¢é¡¯ç¤ºæ™‚æ‰è™•ç†
            if ((modal && modal.classList.contains('show')) || (echoPage && echoPage.style.display !== 'none')) {
                const items = (event.clipboardData || event.originalEvent.clipboardData).items;
                const files = [];
                for (let i = 0; i < items.length; i++) {
                    if (items[i].kind === 'file' && items[i].type.startsWith('image/')) {
                        files.push(items[i].getAsFile());
                    }
                }
                
                if (files.length > 0) {
                    event.preventDefault(); // é˜²æ­¢ç€è¦½å™¨é è¨­è²¼ä¸Šè¡Œç‚º
                    if (modal) modal.classList.remove('show'); // é—œé–‰èªªæ˜è¦–çª—
                    if (typeof processImportImages === 'function') {
                        await processImportImages(files); // ç›´æ¥å‘¼å«åŒ¯å…¥è™•ç†å‡½å¼
                    }
                }
            }
        });

        function initNewFeatures() {
            const container = document.getElementById('featureTabsContainer');
            if (!container) return;

            const data = window.newFeaturesData || [];
            container.innerHTML = '';
            
            data.forEach((feature, index) => {
                const btn = document.createElement('button');
                btn.className = 'switch-btn';
                if (index === 0) btn.classList.add('active');
                btn.textContent = feature.title;
                btn.onclick = () => selectFeature(index);
                container.appendChild(btn);
            });

            if (data.length > 0) selectFeature(0);
        }

        function selectFeature(index) {
            const data = window.newFeaturesData || [];
            const feature = data[index];
            if (!feature) return;

            const tabsContainer = document.getElementById('featureTabsContainer');
            Array.from(tabsContainer.children).forEach((btn, i) => {
                btn.classList.toggle('active', i === index);
            });

            document.getElementById('featureTextContent').textContent = feature.content;
            const videoContainer = document.getElementById('featureImageContainer');
            let video = document.getElementById('featureVideo');

            // å¦‚æœ video å…ƒç´ ä¸å­˜åœ¨ï¼ˆä¾‹å¦‚è¢«ä¹‹å‰çš„éŒ¯èª¤è¨Šæ¯è¦†è“‹ï¼‰ï¼Œå‰‡é‡æ–°å»ºç«‹
            if (!video) {
                videoContainer.innerHTML = '<video id="featureVideo" style="max-width: 100%; max-height: 500px; border-radius: 5px;" autoplay loop muted playsinline></video>';
                video = document.getElementById('featureVideo');
            }

            if (feature.mp4) {
                video.src = feature.mp4;
                video.style.display = 'block';
                video.onerror = function() { this.style.display = 'none'; this.parentElement.innerText = 'é è¦½å½±ç‰‡è¼‰å…¥å¤±æ•— (' + feature.mp4 + ')'; };
            } else {
                video.style.display = 'none';
                video.removeAttribute('src');
            }
        }

        function switchHistoryTab(tabName) {
            const isNew = tabName === 'newFeatures';
            document.getElementById('newFeaturesContent').style.display = isNew ? 'block' : 'none';
            document.getElementById('historyContent').style.display = isNew ? 'none' : 'block';
            document.getElementById('btnShowNewFeatures').classList.toggle('active', isNew);
            document.getElementById('btnShowHistory').classList.toggle('active', !isNew);
        }

        function showHistorySection() {
            const sections = ['mainContent', 'echoPageSection', 'rankSection'];
            sections.forEach(id => {
                const el = document.getElementById(id);
                if (el) el.style.display = 'none';
            });

            const historySection = document.getElementById('historySection');
            if (historySection) {
                historySection.style.display = 'block';
                switchHistoryTab('newFeatures');
            }
        }

        // Rank Button Logic
        document.addEventListener('DOMContentLoaded', () => {
            initNewFeatures();
            const rankBtn = document.getElementById('rankBtn');
            const rankSection = document.getElementById('rankSection');

            if (rankBtn) {
                rankBtn.addEventListener('click', () => {
                    // Hide other main sections
                    const sections = ['mainContent', 'echoPageSection', 'historySection'];
                    sections.forEach(id => {
                        const el = document.getElementById(id);
                        if (el) el.style.display = 'none';
                    });

                    if (rankSection) {
                        rankSection.style.display = 'block';

                        // é‡ç½®å ±åæŒ‰éˆ•é¡¯ç¤ºç‹€æ…‹ (é è¨­é¡¯ç¤ºï¼Œå› ç‚ºé è¨­è¼‰å…¥æœ€æ–°æ´»å‹•)
                        const signUpBtn = document.getElementById('rankSignUpBtn');
                        const refreshBtn = document.getElementById('rankRefreshBtn');
                        if (signUpBtn) signUpBtn.style.display = 'inline-flex';
                        if (refreshBtn) refreshBtn.style.display = 'inline-flex';

                        fetchRankData();
                        fetchLimitedTimeEvents();
                    }
                });
            }

            const rankRefreshBtn = document.getElementById('rankRefreshBtn');
            if (rankRefreshBtn) {
                rankRefreshBtn.addEventListener('click', fetchRankDataLive);
            }
        });

        function closeRankSection() {
            const rankSection = document.getElementById('rankSection');
            if (rankSection) rankSection.style.display = 'none';
            showHistorySection();
        }

        async function fetchLimitedTimeEvents() {
            const container = document.getElementById('eventButtonsContainer');
            if (!container) return;

            container.innerHTML = '<div style="color: var(--text-secondary); padding: 10px;">è¼‰å…¥æ´»å‹•åˆ—è¡¨...</div>';

            try {
                const response = await fetch('https://raw.githubusercontent.com/nkxrfxforum/WWEchoScoringToolsWebJSON/refs/heads/main/LimitedTimeEvent.json');
                const data = await response.json();

                container.innerHTML = '';

                if (data && data.LimitedTimeEvent && Array.isArray(data.LimitedTimeEvent)) {
                    // Render details for the first event initially if available
                    if (data.LimitedTimeEvent.length > 0) {
                        renderEventDetails(data.LimitedTimeEvent[0]);
                    }

                    data.LimitedTimeEvent.forEach((event, index) => {
                        const btn = document.createElement('button');
                        btn.className = 'switch-btn';
                        btn.style.display = 'inline-flex';
                        btn.style.alignItems = 'center';
                        btn.style.gap = '8px';
                        btn.style.marginRight = '10px';
                        btn.style.flexShrink = '0';

                        const charName = event.name;
                        const avatarUrl = (typeof resonatorsProfilePicture !== 'undefined') ? resonatorsProfilePicture[charName] : '';

                        if (avatarUrl) {
                            const img = document.createElement('img');
                            img.src = avatarUrl;
                            img.style.width = '30px';
                            img.style.height = '30px';
                            img.style.borderRadius = '50%';
                            img.style.objectFit = 'cover';
                            img.style.border = '1px solid var(--accent-gold)';
                            btn.appendChild(img);
                        }

                        const span = document.createElement('span');
                        span.textContent = event.EventName;
                        btn.appendChild(span);

                        // Set active class for first button
                        if (index === 0) btn.classList.add('active');

                        // ç¶å®šé»æ“Šäº‹ä»¶
                        btn.onclick = () => {
                            // ç§»é™¤å…¶ä»–æŒ‰éˆ•çš„ active æ¨£å¼
                            Array.from(container.children).forEach(c => c.classList.remove('active'));
                            btn.classList.add('active');

                            // Render details
                            renderEventDetails(event);

                            const signUpBtn = document.getElementById('rankSignUpBtn');
                            const refreshBtn = document.getElementById('rankRefreshBtn');
                            if (event.EventEnd === 0) {
                                if (signUpBtn) signUpBtn.style.display = 'inline-flex';
                                if (refreshBtn) refreshBtn.style.display = 'inline-flex';
                                fetchRankData(); // è¼‰å…¥å³æ™‚è³‡æ–™
                            } else {
                                if (signUpBtn) signUpBtn.style.display = 'none';
                                if (refreshBtn) refreshBtn.style.display = 'none';
                                fetchHistoricalRankData(event.EventName); // è¼‰å…¥æ­·å²è³‡æ–™
                            }
                        };

                        container.appendChild(btn);
                    });
                } else {
                    container.innerHTML = '<div style="color: var(--text-secondary); padding: 10px;">æš«ç„¡æ´»å‹•</div>';
                }
            } catch (e) {
                console.error('Fetch events error:', e);
                container.innerHTML = '<div style="color: var(--accent-red); padding: 10px;">è¼‰å…¥æ´»å‹•å¤±æ•—</div>';
            }
        }

        window.currentActiveEvent = null;


        function renderEventDetails(event) {
            window.currentActiveEvent = event;
            const container = document.getElementById('eventDetailsContainer');
            if (!container) return;

            const setsStr = event.echo_sets ? event.echo_sets.map(s => {
                const names = s.name.split('/');
                const displayName = names.length > 1 ? `(${names.join(' æˆ– ')})` : s.name;
                return `${s.quantity}*${displayName}`;
            }).join('+') : '';
            const costStr = event.cost_distribution ? event.cost_distribution.join('') : '';

            const mainStatsParts = [];
            if (event.main_stats) {
                const order = ['cost_4', 'cost_3', 'cost_1'];
                order.forEach(key => {
                    if (event.main_stats[key] && event.main_stats[key].length > 0) {
                        const costNum = key.replace('cost_', '');
                        const stats = event.main_stats[key].join('ã€');
                        mainStatsParts.push(`${costNum}Cost(${stats})`);
                    }
                });
            }
            const mainStatsStr = mainStatsParts.join('ã€');

            container.innerHTML = `
                <div><span style="color: var(--accent-gold); font-weight: bold;">è§’è‰²:</span> ${event.name || ''}</div>
                <div><span style="color: var(--accent-gold); font-weight: bold;">å±¬æ€§çµ„åˆ:</span> ${setsStr}</div>
                <div><span style="color: var(--accent-gold); font-weight: bold;">Costçµ„åˆ:</span> ${costStr}</div>
                <div><span style="color: var(--accent-gold); font-weight: bold;">ä¸»è©æ¢:</span> ${mainStatsStr}</div>
            `;
        }

        function renderRankTable(data) {
            const loading = document.getElementById('rankLoading');
            const container = document.getElementById('rankListContainer');
            const tbody = document.getElementById('rankTableBody');

            if (!tbody) return;

            tbody.innerHTML = '';

            if (!data || data.length === 0) {
                if (loading) loading.style.display = 'none';
                if (container) container.style.display = 'block';
                tbody.innerHTML = '<tr><td colspan="5" style="text-align:center; padding: 20px;">æš«ç„¡è³‡æ–™</td></tr>';
                return;
            }

            data.forEach((item, index) => {
                const tr = document.createElement('tr');
                tr.style.borderBottom = '1px solid rgba(255, 255, 255, 0.05)';
                tr.style.transition = 'background 0.3s';
                tr.onmouseover = () => tr.style.background = 'rgba(255, 215, 0, 0.05)';
                tr.onmouseout = () => tr.style.background = 'transparent';

                // Rank
                const tdRank = document.createElement('td');
                tdRank.style.padding = '15px';
                tdRank.style.fontWeight = 'bold';
                const rank = item.rank || (index + 1);
                tdRank.textContent = rank;

                if (rank == 1) {
                    tdRank.style.color = '#FFD700';
                    tdRank.style.fontSize = '1.2rem';
                } else if (rank == 2) {
                    tdRank.style.color = '#C0C0C0';
                    tdRank.style.fontSize = '1.1rem';
                } else if (rank == 3) {
                    tdRank.style.color = '#CD7F32';
                    tdRank.style.fontSize = '1.1rem';
                } else {
                    tdRank.style.color = 'var(--text-secondary)';
                }
                tr.appendChild(tdRank);

                // UID
                const tdUid = document.createElement('td');
                tdUid.style.padding = '15px';
                tdUid.style.fontFamily = 'monospace';
                tdUid.style.fontSize = '1.1rem';
                tdUid.textContent = item.UID || item.uid || 'N/A';
                tr.appendChild(tdUid);

                // Character Avatar
                const tdAvatar = document.createElement('td');
                tdAvatar.style.padding = '15px';
                tdAvatar.style.display = 'flex';
                tdAvatar.style.alignItems = 'center';
                tdAvatar.style.gap = '10px';

                const charName = item['è§’è‰²'] || item.role || item.character || item.name || 'æœªçŸ¥';
                const imgUrl = (typeof resonatorsProfilePicture !== 'undefined') ? resonatorsProfilePicture[charName] : '';

                if (imgUrl) {
                    const img = document.createElement('img');
                    img.src = imgUrl;
                    img.style.width = '40px';
                    img.style.height = '40px';
                    img.style.borderRadius = '50%';
                    img.style.objectFit = 'cover';
                    img.style.border = '2px solid var(--accent-gold)';
                    tdAvatar.appendChild(img);
                }

                const nameSpan = document.createElement('span');
                nameSpan.textContent = charName;
                tdAvatar.appendChild(nameSpan);
                tr.appendChild(tdAvatar);

                // Score
                const tdScore = document.createElement('td');
                tdScore.style.padding = '15px';
                tdScore.style.fontWeight = 'bold';
                tdScore.style.color = 'var(--accent-gold)';
                tdScore.style.fontSize = '1.1rem';
                tdScore.textContent = item['åˆ†æ•¸'] || item.score || item.Score || 0;
                tr.appendChild(tdScore);

                // Card Link
                const tdLink = document.createElement('td');
                tdLink.style.padding = '15px';
                tdLink.style.textAlign = 'center';

                const linkUrl = item['åœ–ç‰‡ç¶²å€'] || item.link || item.cardUrl || item.url;

                if (linkUrl) {
                    const btn = document.createElement('a');
                    btn.href = linkUrl;
                    btn.target = '_blank';
                    btn.className = 'switch-btn';
                    btn.style.textDecoration = 'none';
                    btn.style.padding = '5px 15px';
                    btn.style.fontSize = '1rem';
                    btn.style.display = 'inline-flex';
                    btn.style.alignItems = 'center';
                    btn.style.justifyContent = 'center';
                    btn.innerHTML = 'æŸ¥çœ‹å¡ç‰‡';
                    tdLink.appendChild(btn);
                } else {
                    tdLink.textContent = '-';
                }
                tr.appendChild(tdLink);

                tbody.appendChild(tr);
            });

            if (loading) loading.style.display = 'none';
            if (container) container.style.display = 'block';
        }

        async function fetchRankData() {
            const url = 'https://raw.githubusercontent.com/nkxrfxforum/WWEchoScoringToolsWebJSON/refs/heads/main/LimitedTimeEventRank.json';
            await performRankFetch(url, 'æ­£åœ¨è¼‰å…¥æ’è¡Œæ¦œè³‡æ–™...');
        }

        async function fetchRankDataLive() {
            const url = 'https://script.google.com/macros/s/AKfycbwapkkeMdr4vR4Gao4lzN_qBiAuvLePKwv5J0X_J5PjP8HTxDS5IQ0peY3gvHbBkbD5uw/exec';
            await performRankFetch(url, 'æ­£åœ¨åˆ·æ–°æ’è¡Œæ¦œè³‡æ–™...');
        }

        window.fetchRankDataLive = fetchRankDataLive;

        async function performRankFetch(url, loadingText) {
            const loading = document.getElementById('rankLoading');
            const container = document.getElementById('rankListContainer');

            if (loading) {
                loading.style.display = 'block';
                loading.textContent = loadingText;
                loading.style.color = 'var(--text-secondary)';
            }
            if (container) container.style.display = 'none';

            try {
                const response = await fetch(url);
                const data = await response.json();
                renderRankTable(data);
            } catch (err) {
                console.error('Fetch error:', err);
                if (loading) {
                    loading.textContent = 'ç„¡æ³•è¼‰å…¥æ’è¡Œæ¦œè³‡æ–™ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚';
                    loading.style.color = 'var(--accent-red)';
                }
            }
        }

        async function fetchHistoricalRankData(eventName) {
            const loading = document.getElementById('rankLoading');
            const container = document.getElementById('rankListContainer');

            if (loading) {
                loading.style.display = 'block';
                loading.textContent = 'æ­£åœ¨è¼‰å…¥æ­·å²è³‡æ–™...';
                loading.style.color = 'var(--text-secondary)';
            }
            if (container) container.style.display = 'none';

            try {
                const response = await fetch('https://raw.githubusercontent.com/nkxrfxforum/WWEchoScoringToolsWebJSON/refs/heads/main/HistoricalLimitedTimeEvent.json');
                const fullData = await response.json();
                const data = fullData[eventName] || [];
                renderRankTable(data);
            } catch (err) {
                console.error('Fetch historical error:', err);
                if (loading) {
                    loading.textContent = 'ç„¡æ³•è¼‰å…¥æ­·å²è³‡æ–™ã€‚';
                    loading.style.color = 'var(--accent-red)';
                }
            }
        }
    </script>
    <!-- Debug Modal -->
    <div class="modal" id="debugModal" style="z-index: 3000;">
        <div class="modal-content" style="max-width: 900px;">
            <span class="close-btn" id="closeDebugModalBtn">&times;</span>
            <h1 style="color: var(--accent-gold); margin-bottom: 1.5rem;">è¾¨è­˜å°ç…§é™¤éŒ¯</h1>

            <div id="debugContent"
                style="display: flex; flex-direction: column; gap: 1rem; max-height: 60vh; overflow-y: auto; padding-right: 10px;">
                <!-- Debug rows will be injected here -->
            </div>

            <div class="section" style="margin-top: 2rem; text-align: right;">
                <button class="btn" id="reportDebugBtn"
                    style="width: auto; padding: 0.8rem 2rem; background: var(--accent-red); color: white;">å›å ±</button>
            </div>
        </div>
    </div>
</body>

</html>

</html>